Foundry.run(function(a){var b={using:[],inside:{},within:[],exclude:[],match:function(a){},depth:1},c=function(a,b){return typeof a=="string"||typeof a=="number"?a.toUpperCase().indexOf(b.toUpperCase())>=0:!1};a.lookup=function(d){typeof d=="string"&&(d={using:arguments[0],dataset:arguments[1]||{}}),d=a.extend({},b,d);if(a.isEmptyObject(d.inside))return{};typeof d.using=="string"&&(d.using=a.trim(d.using).split(" "));if(d.using.length<1)return d.inside;typeof d.within=="string"&&(d.within=a.trim(d.within).split(" "));var e=a.makeArray(a.extend(!0,{length:d.inside.length},d.inside)),f=[];return a.each(d.using,function(b,g){f=f.concat(a.grep(e,function(b){var e=!1;if(b[".added"])return;a.each(d.exclude,function(a,d){for(key in d)return e=c(b[key],d[key]),!e});if(e)return!1;if(d.within.length>0)a.each(d.within,function(a,d){return e=c(b[d],g),!e});else for(key in b){e=c(b[key],g);if(e)break}return e&&(b[".added"]=!0),e}))}),f}});